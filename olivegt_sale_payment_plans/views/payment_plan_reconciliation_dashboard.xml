<?xml version="1.0" encoding="UTF-8"?>
<odoo>
    <!-- Payment Plan Dashboard List View -->
    <record id="view_payment_plan_dashboard_list" model="ir.ui.view">
        <field name="name">payment.plan.line.dashboard.list</field>
        <field name="model">payment.plan.line</field>
        <field name="arch" type="xml">
            <list create="0" delete="0">
                <field name="payment_plan_id"/>
                <field name="name"/>
                <field name="date"/>
                <field name="amount" 
                        sum="Total Amount" 
                        widget="monetary" 
                        options="{'currency_field': 'currency_id'}"/>
                <field name="total_with_interest" 
                        sum="Total + Interest" 
                        widget="monetary" 
                        options="{'currency_field': 'currency_id'}"/>
                <field name="allocated_amount" 
                        sum="Total Allocated" 
                        widget="monetary" 
                        options="{'currency_field': 'currency_id'}"/>
                <field name="move_lines_summary" 
                        widget="html" 
                        string="Payment Details" 
                        options="{'width': '350px'}"/>
                <field name="state" widget="badge"/>
            </list>
        </field>
    </record>

    <!-- Payment Plan Line Search View Update for Dashboard -->
    <record id="payment_plan_line_view_search_dashboard" model="ir.ui.view">
        <field name="name">payment.plan.line.search.dashboard</field>
        <field name="model">payment.plan.line</field>
        <field name="arch" type="xml">
            <search>
                <field name="name"/>
                <field name="payment_plan_id"/>
                <separator/>
                <filter string="Unpaid" name="unpaid" domain="[('paid', '=', False)]"/>
                <filter string="Paid" name="paid" domain="[('paid', '=', True)]"/>
                <separator/>
                <filter string="Overdue" name="overdue" domain="[('state', '=', 'overdue')]"/>
                <filter string="Not Allocated" name="not_allocated" domain="[('allocation_state', '=', 'none')]"/>
                <filter string="Partially Allocated" name="partially_allocated" domain="[('allocation_state', '=', 'partial')]"/>
                <filter string="Fully Allocated" name="fully_allocated" domain="[('allocation_state', '=', 'full')]"/>
                <group expand="0" string="Group By">
                    <filter string="Payment Plan" name="group_by_plan" domain="[]" context="{'group_by': 'payment_plan_id'}"/>
                    <filter string="Due Date" name="group_by_date" domain="[]" context="{'group_by': 'date:month'}"/>
                    <filter string="Status" name="group_by_state" domain="[]" context="{'group_by': 'state'}"/>
                </group>
            </search>
        </field>
    </record>

    <!-- Payment Plan Reconciliation Dashboard Action -->
    <record id="action_payment_plan_reconciliation_dashboard" model="ir.actions.act_window">
        <field name="name">Payment Reconciliation Dashboard</field>
        <field name="res_model">payment.plan.line</field>
        <field name="view_mode">list,form</field>
        <field name="view_id" ref="view_payment_plan_dashboard_list"/>
        <field name="domain">[('payment_plan_id.state', '=', 'posted')]</field>
        <field name="context">{'search_default_unpaid': 1}</field>
        <field name="help" type="html">
            <p class="o_view_nocontent_empty_folder">
                No payment plan lines found
            </p>
            <p>
                Create payment plans to see them here.
            </p>
        </field>
    </record>

    <!-- Dashboard Menu Item -->
    <menuitem id="menu_payment_plan_reconciliation_dashboard"
        name="Reconciliation Dashboard"
        parent="menu_payment_plans_root"
        action="action_payment_plan_reconciliation_dashboard"
        sequence="15"/>
</odoo>
